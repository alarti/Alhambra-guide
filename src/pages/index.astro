---
import Layout from '../layouts/Layout.astro';
import Auth from '../components/Auth.astro';
---

<Layout title="Alhambra and Generalife, Granada">
    <div id="map-container"></div>

    <div id="side-panel">
        <button id="panel-toggle-btn">☰</button>
        <div class="panel-content">
            <h1 id="guide-title">Alhambra and Generalife, Granada</h1>
            <div id="guide-meta-container" class="hidden">
                <p class="text-muted mb-2">by <span id="author-name"></span></p>
                <a id="donation-link" href="#" target="_blank" rel="noopener noreferrer" class="btn-modern btn-modern-secondary btn-modern-sm">
                    Support the author ☕
                </a>
            </div>
            <hr>
            
            <div class="mb-3">
                <label for="language-selector" class="form-label">Language</label>
                <select id="language-selector" class="form-select">
                    <!-- Languages will be dynamically inserted here -->
                </select>
            </div>

            <div class="form-check form-switch my-3">
                <input class="form-check-input" type="checkbox" role="switch" id="simulation-mode-toggle" checked>
                <label class="form-check-label" for="simulation-mode-toggle" data-key="simulationMode">Simulation Mode</label>
            </div>

            <div class="form-check form-switch my-3">
                <input class="form-check-input" type="checkbox" role="switch" id="theme-toggle">
                <label class="form-check-label" for="theme-toggle">Light Mode</label>
            </div>
            <hr>

            <div id="auth-section">
                <!-- This container will be shown/hidden by the script -->
                <div id="login-container">
                    <Auth />
                </div>

                <!-- This container is hidden by default and shown on login -->
                <div id="session-container" style="display: none;">
                    <p>Bienvenido, <strong id="user-email-display"></strong></p>
                    <button id="logout-button" class="btn-modern btn-modern-secondary">Cerrar Sesión</button>
                </div>
            </div>
            <hr>

            <div id="mode-controls" class="d-grid gap-2">
                <!-- This will be populated by JS -->
            </div>

            <hr>

            <div id="controls" class="d-grid gap-2">
                <button id="play-btn" data-key="play">Play</button>
                <button id="pause-btn" data-key="pause">Pause</button>
                <button id="stop-btn" data-key="stop">Stop</button>
            </div>

            <hr>

            <div id="poi-list-container">
                <h5>Points of Interest</h5>
                <ul id="poi-list" class="list-group list-group-flush">
                    <!-- POIs will be dynamically inserted here -->
                </ul>
            </div>
            
            <div id="support-container" class="mt-4 d-grid gap-2">
                <button id="about-btn" class="btn-modern btn-modern-secondary">About</button>
                <a href="https://www.buymeacoffee.com/albertoarce" target="_blank" rel="noopener noreferrer" class="btn-modern btn-modern-secondary">
                    Buy me a coffee ☕
                </a>
            </div>
        </div>
    </div>

    <div id="welcome-modal" class="modal-overlay"> <!-- Initially visible -->
        <div class="modal-content">
            <h2>Welcome to the Interactive Guide</h2>
            <p>Choose a featured guide or create your own.</p>
            <div id="guide-catalog-list" class="list-group my-3">
                <!-- Guide list will be populated here -->
            </div>
            <hr>
            <button id="create-new-guide-btn" class="btn-modern btn-modern-success">Create a New Guide</button>
        </div>
    </div>

    <div id="about-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <h2>About Alhambra Voice Guide</h2>
            <p>This application was developed by Alberto Arce.</p>
            <p>An interactive audio guide to explore the wonders of the Alhambra.</p>
            <p>
                <a href="https://github.com/alarti" target="_blank" rel="noopener noreferrer">View on GitHub</a>
            </p>
        </div>
    </div>
    
    <div id="guide-text-overlay">
        <p></p>
    </div>

    <!-- The old main.js logic will be re-implemented here or in separate components -->
    <script is:inline>
        // Placeholder for the new logic
        console.log("Astro site is running!");
        // We will migrate the logic from the old main.js here,
        // ideally breaking it into smaller, manageable components/scripts.
        // For now, let's just make the welcome modal visible.
        document.addEventListener('DOMContentLoaded', () => {
             // The original JS will be ported later. For now, this is just a placeholder.
        });
    </script>
    <script type="module" src="../scripts/guards.js"></script>
</Layout>
